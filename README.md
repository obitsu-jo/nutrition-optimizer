# Nutrition Optimizer （栄養最適化プロジェクト）

線形計画法を使って栄養バランスとコストを最適化する食事プランを提案するツールです。

## 🎯 概要

文部科学省の「日本食品標準成分表」を活用し、設定された栄養制約を満たしながら食費を最小化する献立を自動計算します。

## 🚀 使用方法

### 3ステップで簡単実行

```bash
# Step1: 制約条件を設定
python src/step1_constraints.py

# Step2: 使用する食品を選択・価格設定  
python src/step2_foods.py

# Step3: 最適化計算を実行
python src/step3_optimize.py
```

### 📋 各ステップの詳細

#### Step1: 制約条件設定 (`step1_constraints.py`)
- **目的**: 栄養摂取目標を設定
- **設定項目**: 
  - エネルギー、たんぱく質、脂質、炭水化物など
  - 各栄養素の最小値・最大値
  - 特定食品の摂取上限（オプション）
- **出力**: `data/input/constraints.json`

#### Step2: 食品情報設定 (`step2_foods.py`)
- **目的**: 使用する食品を選択し価格を設定
- **機能**:
  - 食品成分表から自動で栄養データを取得
  - 食品名の部分一致検索
  - 100gあたりの価格設定
- **出力**: `data/input/foods.csv`

#### Step3: 最適化計算 (`step3_optimize.py`)
- **目的**: 制約条件下でコスト最小の献立を計算
- **機能**:
  - 線形計画法による最適化
  - 詳細な栄養成分分析
  - 結果の保存とレポート生成
- **出力**: `data/output/optimization_result_YYYYMMDD_HHMMSS.json`

## 📁 プロジェクト構造

```
nutrition-optimizer/
├── src/
│   ├── step1_constraints.py    # Step1: 制約設定
│   ├── step2_foods.py          # Step2: 食品選択
│   ├── step3_optimize.py       # Step3: 最適化実行
│   └── core/                   # コア機能
│       ├── nutrition_mapping.py   # 栄養素マッピング
│       ├── data_loader.py         # データ読み込み
│       ├── optimizer.py           # 最適化エンジン
│       └── food_helper.py         # 食品データベース
├── data/
│   ├── raw/                    # 食品成分表（生データ）
│   ├── input/                  # 設定ファイル
│   └── output/                 # 計算結果
└── tools/                      # 開発・テスト用ツール
```

## 🛠️ 技術仕様

- **言語**: Python 3.11+
- **主要ライブラリ**: 
  - PuLP: 線形計画法
  - Pandas: データ処理
  - openpyxl: Excelファイル読み込み
- **最適化対象**: 53種類の栄養素
- **データソース**: 日本食品標準成分表（八訂）増補2023年版

## 📊 対応栄養素

**主要栄養素**: エネルギー、たんぱく質、脂質、炭水化物、食物繊維  
**ミネラル**: カリウム、カルシウム、マグネシウム、リン、鉄、亜鉛など  
**ビタミン**: ビタミンA、D、E、K、ビタミンB群、ビタミンCなど

## 🎯 実行例

```
=== 最適化結果 ===
💰 最小コスト: 876.64円/日

🍽️ 推奨食品と摂取量:
  • こめ［水稲穀粒］精白米うるち米
    摂取量: 437.2g
    コスト: 262.35円
  • 鶏卵全卵生  
    摂取量: 138.0g
    コスト: 276.02円

📊 栄養成分:
  • エネルギー: 2016.74 kcal (2000-2500)
  • たんぱく質: 59.99 g (60-120) 
  • 脂質: 40.0 g (40-80)
  • 炭水化物: 349.96 g (250-350)
```

## 🔧 開発・テスト用ツール

- `tools/test_search.py`: 食品検索機能のテスト
- `tools/analyze_data.py`: 食品成分表の構造分析
- `tools/test_interactive.py`: サンプルデータ生成

## 📋 必要なデータファイル

1. **食品成分表**: `data/raw/20230428-mxt_kagsei-mext_00001_012.xlsx`
   - [文部科学省サイト](https://www.mext.go.jp/a_menu/syokuhinseibun/mext_00001.html)からダウンロード

## 🎓 学習ポイント

- **線形計画法**: 制約最適化の実践的応用
- **データ処理**: 大規模な表形式データの効率的な処理  
- **システム設計**: モジュール化された実用的なツール開発